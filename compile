ABSPATH="/home/fusiled/Desktop/orpsocV3"

cd $ABSPATH

rm -d -r build

mkdir build

cd build

iverilog-vpi --name=elf-loader -lelf -I$ABSPATH/src/elf-loader $ABSPATH/src/elf-loader/elf-loader.c $ABSPATH/src/elf-loader/vpi_wrapper.c

iverilog-vpi --name=jtag_vpi-r2 $ABSPATH/src/jtag_vpi-r2/jtag_vpi.c

iverilog -s orpsoc_tb -c $ABSPATH/file_list.scr -o fusesoc.elf -DSIM

if [ -z $1 ]; then
	ELF_PATH=$ABSPATH/def/test.out
else
	ELF_PATH=$ABSPATH/$1
fi

vvp -n -M. -l icarus.log -melf-loader -mjtag_vpi-r2 fusesoc.elf -lxt2 +elf_load=$ELF_PATH